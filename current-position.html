<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, user-scalable=no, maximum-scale=1.0, initial-scale=1.0, minimum-scale=1.0">
		<title>Velcom</title>
		<link href="./css/style.css" rel="stylesheet">
		<link href="./css/extra.css" rel="stylesheet">
		<link href="./css/rome.css" rel="stylesheet">
		
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
		
		<script type="text/javascript" src="./js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="./js/jquery.nicescroll.min.js" ></script>
		<script type="text/javascript" src="./js/jquery.formstyler.min.js"></script>
		<script type="text/javascript" src="./js/rome.js"></script>
		<script type="text/javascript" src="./js/tmpl.min.js"></script>
		<script type="text/javascript">document.addEventListener("touchstart", function() {},false);</script>
		
		<script type="text/javascript" src="./js/gps/xtmpl.js"></script>
		<script type="text/javascript" src="./js/gps/xdate.js"></script>
		<script type="text/javascript" src="./js/gps/json_handler.js"></script>
		<script type="text/javascript" src="./js/gps/api.js"></script>
		<script type="text/javascript" src="./js/gps/google-maps.js"></script>
		<script type="text/javascript" src="./js/gps/map-objects-panel.js"></script>
		<script type="text/javascript" src="./js/gps/popup.js"></script>
		
		
		
		<script type="text/javascript">
var objects = [], markers = [], objectsPanel;

$(function(){
	aModules = ['header', 'panel-map-object-list', 'panel-map-object-item', 'popup', 'popup-add-object'];
	Tmpl().loadModules(aModules, function(){ 
		setCurrMenu(2, 1);
		
		objectsPanel = new MapObjectsPanel();
		objectsPanel.init();
	});
});



function initialize(objects) {
  var mapOptions = {
    zoom: 10
  };
  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
  google.maps.event.addListener(map, 'click', function(event) {
	console.log(event.latLng);
	console.log([event.latLng.lat(), event.latLng.lng()]);
        // addMarker(event.latLng);
  });
  // Try HTML5 geolocation
  if(navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(p) {
      var pos = new google.maps.LatLng(p.coords.latitude, p.coords.longitude);

      var marker = new google.maps.Marker({
            position: pos,
            map: map,
            title: '<div style="height:60px;width:200px"><b>Your location:</b><br />Latitude: ' + p.coords.latitude + '<br />Longitude: ' + p.coords.longitude + '</div>'
        });
        
      var infowindow = new google.maps.InfoWindow({
        map: map,
        position: pos,
        content: 'Location found using HTML5.'
      });

      map.setCenter(pos);
      /*
      for(var i = 0; i < objects.length; i++) {
      	var pos = new google.maps.LatLng(objects[i].lat, objects[i].lng);
      	 var marker = new google.maps.Marker({
            position: pos,
            map: map,
            title: objects[i].name
        });
        console.log('4!');
        markers.push(marker);
      }
      */
    }, function() {
      handleNoGeolocation(true);
    });
  } else {
    // Browser doesn't support Geolocation
    handleNoGeolocation(false);
  }
}

function handleNoGeolocation(errorFlag) {
  if (errorFlag) {
    var content = 'Error: The Geolocation service failed.';
  } else {
    var content = 'Error: Your browser doesn\'t support geolocation.';
  }

  var options = {
    map: map,
    position: new google.maps.LatLng(60, 105),
    content: content
  };

  var infowindow = new google.maps.InfoWindow(options);
  map.setCenter(options.position);
}

// google.maps.event.addDomListener(window, 'load', initialize);
/*
google.maps.event.addListener(map, 'click', function(event) {
	console.log(event.latLng);
    // addMarker(event.latLng);
});
*/
</script>
<!--script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
$(function(){
if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function (p) {
        var LatLng = new google.maps.LatLng(p.coords.latitude, p.coords.longitude);
        var mapOptions = {
            center: LatLng,
            zoom: 13,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("dvMap"), mapOptions);
        var marker = new google.maps.Marker({
            position: LatLng,
            map: map,
            title: "<div style = 'height:60px;width:200px'><b>Your location:</b><br />Latitude: " + p.coords.latitude + "<br />Longitude: " + p.coords.longitude
        });
        google.maps.event.addListener(marker, "click", function (e) {
            var infoWindow = new google.maps.InfoWindow();
            infoWindow.setContent(marker.title);
            infoWindow.open(map, marker);
        });
    });
} else {
    alert('Geo Location feature is not supported in this browser.');
}
});
</script-->
	</head>
	<body>
		<div class="mainContainer">
			<div class="header clearfix tmpl-header"></div>
			<div class="maket clearfix">
				<div class="leftSide">
					<div class="block tmpl-panel-map-object-list"></div>
				</div>
				<div class="rightSide">
					<div id="map-canvas" class="mapContainer" style="border: 1px solid red; height: 300px;"></div>
				</div>
			</div>
			<div class="contacts tmpl-footer"></div>
		</div>
	</body>
</html>